{
  "openapi": "3.0.3",
  "info": {
    "title": "ProjectX Music & Voices API",
    "version": "1.0",
    "description": "API to control TTS (ElevenLabs) and Spotify playback for Project X."
  },
  "servers": [{ "url": "https://<BASE_URL>" }],
  "components": {
    "schemas": {
      "VoiceSettings": {
        "type": "object",
        "properties": {
          "stability": { "type": "number" },
          "similarity_boost": { "type": "number" },
          "style": { "type": "string" },
          "emotion": { "type": "string" }
        }
      },
      "TTSRequest": {
        "type": "object",
        "required": ["voice_id","text"],
        "properties": {
          "voice_id": { "type": "string" },
          "text": { "type": "string" },
          "voice_settings": { "$ref": "#/components/schemas/VoiceSettings" },
          "format": { "type": "string", "enum": ["audio/mpeg","audio/wav"], "default":"audio/mpeg" },
          "language": { "type": "string", "default":"en" },
          "persist": { "type": "boolean", "default": false }
        }
      },
      "PlayRequest": {
        "type": "object",
        "required": ["spotify_uri"],
        "properties": {
          "spotify_uri": { "type": "string" },
          "start_ms": { "type": "integer" },
          "loop": { "type": "boolean" },
          "phase": { "type": "string" },
          "loop_segment": { "type": "object", "properties": { "start_ms": { "type": "integer" }, "end_ms": { "type": "integer" } } },
          "fade_ms": { "type": "integer" }
        }
      },
      "AutoSelectRequest": {
        "type": "object",
        "required": ["battle_context"],
        "properties": {
          "battle_context": {
            "type": "object",
            "properties": {
              "battle_type": { "type": "string" },
              "is_boss": { "type": "boolean" },
              "phase": { "type": "string" },
              "intensity": { "type": "integer", "minimum": 1, "maximum": 10 },
              "characters": { "type": "array", "items": { "type": "string" } },
              "playlist_uris": { "type": "array", "items": { "type": "string" } }
            }
          },
          "max_results": { "type": "integer", "default": 1 }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "Token" }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/": {
      "get": {
        "summary": "Health check",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/voices": {
      "get": {
        "summary": "Get Voices Catalog",
        "responses": { "200": { "description": "Voices list" } }
      }
    },
    "/characters": {
      "get": { "summary": "List Characters", "responses": { "200": { "description": "List" } } },
      "post": {
        "summary": "Create/Update Character",
        "requestBody": { "content": { "application/json": { "schema": { "type":"object" } } } },
        "responses": { "200": { "description": "Saved" } }
      }
    },
    "/tts": {
      "post": {
        "summary": "Synthesize TTS",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref":"#/components/schemas/TTSRequest" } } } },
        "responses": { "200": { "description": "Audio result (url/base64)" } }
      }
    },
    "/play": {
      "post": {
        "summary": "Play Spotify URI",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref":"#/components/schemas/PlayRequest" } } } },
        "responses": { "200": { "description": "Playback started/queued" } }
      }
    },
    "/auto_select": {
      "post": {
        "summary": "Auto-select battle track",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref":"#/components/schemas/AutoSelectRequest" } } } },
        "responses": { "200": { "description": "Selection results" } }
      }
    },
    "/phase": {
      "post": {
        "summary": "Set music phase",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type":"object", "properties": { "phase": { "type": "string" }, "loop_segment": { "type": "object" }, "fade_out_ms": { "type":"integer" }, "fade_in_ms": { "type":"integer" } }, "required":["phase"] } } } },
        "responses": { "200": { "description": "Phase set" } }
      }
    },
    "/status": {
      "get": { "summary": "Playback status", "responses": { "200": { "description": "Status" } } }
    },
    "/pause": {
      "post": { "summary": "Pause playback", "requestBody": { "content": { "application/json": { "schema": { "type":"object", "properties": { "fade_ms": { "type":"integer" } } } } } }, "responses": { "200": { "description": "Paused" } } }
    },
    "/resume": {
      "post": { "summary": "Resume playback", "requestBody": { "content": { "application/json": { "schema": { "type":"object", "properties": { "fade_ms": { "type":"integer" } } } } } }, "responses": { "200": { "description": "Resumed" } } }
    }
  }
}
